<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç –≤–∏–∫–ª–∞–¥–∞—á–∞ | 3Go</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', sans-serif; }
    .hero-bg {
      background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1509062522246-3755977927d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
      background-size: cover; background-position: center; min-height: 50vh; display: flex; align-items: center;
    }
    .menu-slide { transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out; max-height: 0; opacity: 0; overflow: hidden; }
    .menu-slide.open { max-height: 500px; opacity: 1; }
    .hamburger div { transition: all 0.3s ease; }
    .hamburger.open .bar1 { transform: rotate(45deg) translate(5px, 5px); }
    .hamburger.open .bar2 { opacity: 0; }
    .hamburger.open .bar3 { transform: rotate(-45deg) translate(7px, -7px); }
    section { padding-top: 96px; }
    .gradient-text { background: linear-gradient(to right, #2563eb, #a855f7); background-clip: text; -webkit-background-clip: text; color: transparent; display: inline-block; }
    @supports (-webkit-background-clip: text) { .gradient-text { -webkit-background-clip: text; -webkit-text-fill-color: transparent; } }
    @supports not (-webkit-background-clip: text) { .gradient-text { color: #2563eb; } }
    .error-message { color: #f87171; font-weight: bold; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100">
  <nav class="fixed top-0 w-full bg-gradient-to-r from-blue-700 to-purple-600 text-white py-4 z-50 shadow-2xl">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <a href="/" class="text-2xl font-bold">3Go üåü</a>
      <div class="hidden md:flex space-x-6">
        <a href="login_teachers.html" class="text-lg font-medium hover:text-blue-200 transition duration-200">–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</a>
      </div>
      <button id="hamburger-btn" class="md:hidden flex flex-col space-y-1 hamburger">
        <div class="bar1 w-6 h-1 bg-white rounded"></div>
        <div class="bar2 w-6 h-1 bg-white rounded"></div>
        <div class="bar3 w-6 h-1 bg-white rounded"></div>
      </button>
    </div>
    <div id="mobile-menu" class="md:hidden menu-slide mt-4 px-4 bg-gray-800 rounded-lg">
        <a href="login_teachers.html" class="text-lg font-medium hover:text-blue-200 transition duration-200">–í–∏–π—Ç–∏</a>
    </div>
  </nav>

  <section class="hero-bg text-white text-center">
    <div class="container mx-auto px-4 py-16">
      <h1 class="text-5xl font-extrabold mb-6 gradient-text">–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç –≤–∏–∫–ª–∞–¥–∞—á–∞</h1>
    </div>
  </section>

  <section class="py-16 bg-gradient-to-b from-gray-900 to-gray-800">
    <div class="container mx-auto px-4">
      <div id="teacher-info" class="mb-8 text-center bg-gray-800 p-6 rounded-lg shadow-lg border-2 border-blue-900">
        <h2 class="text-2xl font-bold gradient-text">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∏–∫–ª–∞–¥–∞—á–∞</h2>
        <p id="teacher-name" class="text-lg mt-2"></p>
        <p id="teacher-email" class="text-lg mt-2"></p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- –ö—É—Ä—Å–∏ -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg border-2 border-blue-900">
          <h2 class="text-2xl font-bold gradient-text mb-4">–ú–æ—ó –∫—É—Ä—Å–∏</h2>
          <ul id="courses-list" class="space-y-4"></ul>
        </div>

        <!-- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ –∑–∞–Ω—è—Ç—Ç—è -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg border-2 border-blue-900">
          <h2 class="text-2xl font-bold gradient-text mb-4">–Ü–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ñ –∑–∞–Ω—è—Ç—Ç—è</h2>
          <ul id="lessons-list" class="space-y-4"></ul>
        </div>
      </div>
    </div>
  </section>

  <footer class="bg-gradient-to-r from-blue-700 to-purple-600 text-white py-8">
    <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
        <h3>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
        <p class="text-white">üìû +380 731580935</p>
        <p class="text-white">üìß info@3Go.ua</p>
        <p class="text-white">Telegram: @3Go</p>
        <p class="text-white">Instagram: @3Go</p>
      </div>
      <div>
        <h3>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
        <a href="privac.html" class="block text-white hover:text-blue-300 transition duration-200">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a>
      </div>
    </div>
    <p class="text-center mt-8 text-white">¬© 2025 3Go. –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω–æ.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –∑ localStorage
      const token = localStorage.getItem('teacher-token');
      console.log('Token:', token);
      if (!token) {
        alert('–¢–æ–∫–µ–Ω –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É.');
        window.location.href = 'login_teachers.html';
        return;
      }

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –≤–∏–∫–ª–∞–¥–∞—á–∞
      const fetchTeacherProfile = async (retries = 3, delay = 1000) => {
        for (let i = 0; i < retries; i++) {
          try {
            const response = await fetch('https://skillbridge-school-1.onrender.com/api/teacher-profile', {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
              }
            });
            if (!response.ok) {
              const errorText = await response.text();
              if (response.status === 401) {
                alert('–°–µ—Å—ñ—è –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—è. –ë—É–¥—å –ª–∞—Å–∫–∞, —É–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É.');
                localStorage.removeItem('teacher-token');
                window.location.href = 'login_teachers.html';
                return null;
              }
              throw new Error(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é: ${response.status} ${response.statusText} - ${errorText}`);
            }
            const data = await response.json();
            console.log('API Response (Teacher Profile):', data);
            return data;
          } catch (error) {
            console.error(`–°–ø—Ä–æ–±–∞ ${i + 1} –Ω–µ –≤–¥–∞–ª–∞—Å—è:`, error.message);
            if (i < retries - 1) {
              await new Promise(resolve => setTimeout(resolve, delay));
              continue;
            }
            console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é –ø—ñ—Å–ª—è –≤—Å—ñ—Ö —Å–ø—Ä–æ–±:', error.message);
            return null;
          }
        }
      };

      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑–∞ studentId
      const fetchStudentData = async (studentId) => {
        try {
          const response = await fetch(`https://skillbridge-school-1.onrender.com/api/profile?studentId=${studentId}`, {
            method: 'GET',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            }
          });
          if (!response.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞');
          const data = await response.json();
          console.log('Student Data:', data);
          return data;
        } catch (error) {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞:', error);
          return {};
        }
      };

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      const initPage = async () => {
        const teacherData = await fetchTeacherProfile();
        if (!teacherData) {
          const coursesList = document.getElementById('courses-list');
          const lessonsList = document.getElementById('lessons-list');
          const teacherInfo = document.getElementById('teacher-info');
          teacherInfo.innerHTML = '<p class="p-2 bg-gray-700 rounded error-message">–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å –≤–∏–∫–ª–∞–¥–∞—á–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∞–±–æ —É–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É.</p>';
          coursesList.innerHTML = '<li class="p-2 bg-gray-700 rounded error-message">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –∫—É—Ä—Å–∏ —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É —Å–µ—Ä–≤–µ—Ä–∞.</li>';
          lessonsList.innerHTML = '<li class="p-2 bg-gray-700 rounded error-message">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –∑–∞–Ω—è—Ç—Ç—è —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É —Å–µ—Ä–≤–µ—Ä–∞.</li>';
          return;
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–∏–∫–ª–∞–¥–∞—á–∞
        document.getElementById('teacher-name').textContent = `–Ü–º‚Äô—è: ${teacherData.name || '–ù–µ–≤—ñ–¥–æ–º–æ'}`;
        document.getElementById('teacher-email').textContent = `–ü–æ—à—Ç–∞: ${teacherData.email || '–ù–µ–≤—ñ–¥–æ–º–æ'}`;

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
        const coursesList = document.getElementById('courses-list');
        coursesList.innerHTML = '';
        const courses = teacherData.teachesCourses || [];
        console.log('Processed Courses:', courses);
        if (Array.isArray(courses) && courses.length > 0) {
          for (const course of courses) {
            console.log('Processing course:', course);
            const materialsLink = course.materialsLink || '#';
            const listItem = document.createElement('li');
            listItem.className = 'p-2 bg-gray-700 rounded';
            listItem.innerHTML = `
              <strong>–ö—É—Ä—Å: ${course.name || '–ù–µ–≤—ñ–¥–æ–º–æ'}</strong><br>
              –ì—Ä—É–ø–∞: ${course.groupNumber || '–ù–µ–≤—ñ–¥–æ–º–æ'}<br>
              <button onclick="window.location.href='${materialsLink}'" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500 transition duration-200" ${materialsLink === '#' ? 'disabled' : ''}>–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫—É—Ä—Å—É</button>
            `;
            coursesList.appendChild(listItem);
          }
        } else {
          console.log('No courses or invalid format:', courses);
          coursesList.innerHTML = '<li class="p-2 bg-gray-700 rounded">–ù–µ–º–∞—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏—Ö –∫—É—Ä—Å—ñ–≤</li>';
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –∑–∞–Ω—è—Ç—å
        const lessonsList = document.getElementById('lessons-list');
        lessonsList.innerHTML = '';
        if (teacherData.individualLessons && Array.isArray(teacherData.individualLessons) && teacherData.individualLessons.length > 0) {
          for (const lesson of teacherData.individualLessons) {
            const studentData = await fetchStudentData(lesson.studentId);
            console.log('Student Data for lesson:', studentData);
            const materialsLink = lesson.materialsLink || '#';
            const listItem = document.createElement('li');
            listItem.className = 'p-2 bg-gray-700 rounded';
            listItem.innerHTML = `
              <strong>–£—Ä–æ–∫: ${lesson.lesson || '–ù–µ–≤—ñ–¥–æ–º–æ'}</strong><br>
              –°—Ç—É–¥–µ–Ω—Ç: ${studentData.name || '–ù–µ–≤—ñ–¥–æ–º–æ'} (ID: ${lesson.studentId || '–ù–µ–≤—ñ–¥–æ–º–æ'})<br>
              <button onclick="window.location.href='${materialsLink}'" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500 transition duration-200" ${materialsLink === '#' ? 'disabled' : ''}>–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫—É—Ä—Å—É</button>
            `;
            lessonsList.appendChild(listItem);
          }
        } else {
          lessonsList.innerHTML = '<li class="p-2 bg-gray-700 rounded">–ù–µ–º–∞—î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –∑–∞–Ω—è—Ç—å</li>';
        }
      };

      // –í–∏–∫–ª–∏–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
      initPage();

      // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
      const hamburger = document.getElementById('hamburger-btn');
      const menu = document.getElementById('mobile-menu');
      hamburger.addEventListener('click', () => {
        menu.classList.toggle('open');
        hamburger.classList.toggle('open');
      });
      menu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          menu.classList.remove('open');
          hamburger.classList.remove('open');
        });
      });
    });
  </script>
</body>
</html>
